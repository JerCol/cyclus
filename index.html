<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>cyclus 25 7</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <!--
    ðŸ‘‰ Replace YOUR_IMAGE.jpg with your chosen background image.
    ðŸ‘‰ Replace SHEET_ENDPOINT with your Apps Script Web App URL.
  -->
  <style>
    /* Reset and base */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: system-ui, sans-serif; }

    /* Full-screen background */
    body {
      background: url('YOUR_IMAGE.jpg') center/cover no-repeat;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #222;
    }

    /* Counter top-right */
    #counter {
      position: fixed;
      top: 16px;
      right: 16px;
      font-size: 1.5rem;
      background: rgba(255,255,255,0.8);
      padding: 4px 8px;
      border-radius: 4px;
    }

    /* Name wall top-left */
    #nameWall {
      position: fixed;
      top: 16px;
      left: 16px;
      font-size: 10px;
      line-height: 12px;
      color: #444;
      white-space: pre-wrap;
      word-break: break-word;
      max-width: calc(100% - 32px);
    }

    /* Centered form */
    /* Center the form both vertically and horizontally */
    /* Make the form container transparent */
   /* Center the form */
    form {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: transparent !important;
      border: none;
      width: 90%;
      max-width: 360px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    /* Make inputs full-width and lightly outlined */
    form input[type="text"],
    form input[type="tel"] {
      width: 100%;
      padding: 12px;
      font-size: 1rem;
      border: 1px solid #000;
      border-radius: 4px;
      background: rgba(255,255,255,0.5);
      color: #000;
    }
    
    /* Ghost-style button with slight white fill */
    form button {
      -webkit-appearance: none;
      appearance: none;
      width: 100%;
      padding: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      color: #000;
      background: rgba(255,255,255,0.8); /* slight white fill */
      border: 1px solid #000;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    
    /* Tap feedback */
    form button:active,
    form button:focus {
      opacity: 0.6;
      outline: none;
    }



  </style>
</head>
<body>
  <!-- Counter -->
  <div id="counter">0</div>

  <!-- Scrolling names -->
  <div id="nameWall"></div>

  <!-- Centered attendance form -->
  <form id="attendForm" autocomplete="off">
    <input type="text" name="name" placeholder="Your name (optional)">
    <input type="tel" name="phone" placeholder="Phone (optional)">
    <button type="submit">I attend</button>
  </form>

  <script>
    const SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxWHCq6yHcqtt4TEeSXnxkjXtxdD-nakrSoSIe-nBwb8ugojQNYJuN98o8z3vacac0G/exec';

     // JSONP loader to avoid CORS issues
    function loadJSONP(params) {
      const callbackName = 'cb' + Date.now() + Math.random().toString().slice(2);
      return new Promise((resolve, reject) => {
        window[callbackName] = data => {
          delete window[callbackName];
          script.remove();
          resolve(data);
        };
        const script = document.createElement('script');
        script.src = SHEET_ENDPOINT + '?' + new URLSearchParams({...params, callback: callbackName});
        script.onerror = () => reject(new Error('JSONP load error'));
        document.body.appendChild(script);
      });
    }

    async function fetchNames() {
      const list = await loadJSONP({action: 'read'});
      render(list);
    }

    async function writeName(name, phone) {
      const list = await loadJSONP({action: 'write', name, phone});
      render(list);
    }


    document.getElementById('attendForm').addEventListener('submit', async e => {
      e.preventDefault();
      const fd    = new FormData(e.target);
      const name  = fd.get('name').trim();
      const phone = fd.get('phone').trim();
      await writeName(name, phone);
  
      if (confirm("Would you like to add this event to your calendar?")) {
        // UTC times for CEST 25 Jul 2025 20:00 â†’ 26 Jul 2025 06:00
        const dtStartUTC = '20250725T180000Z';
        const dtEndUTC   = '20250726T040000Z';
  
        const icsLines = [
          'BEGIN:VCALENDAR',
          'VERSION:2.0',
          'PRODID:-//YourDomain//AttendanceEvent//EN',
          'BEGIN:VEVENT',
          `UID:${Date.now()}@yourdomain.com`,
          `DTSTAMP:${new Date().toISOString().replace(/[-:.]/g,'').slice(0,15)}Z`,
          `DTSTART:${dtStartUTC}`,
          `DTEND:${dtEndUTC}`,
          'SUMMARY:Cyclus',
          'LOCATION:JH Tongeluk Ganshoren',
          'DESCRIPTION:Thanks for RSVPing to Cyclus!',
          'END:VEVENT',
          'END:VCALENDAR'
        ];
  
        const blob = new Blob([icsLines.join('\r\n')], { type: 'text/calendar' });
        const url  = URL.createObjectURL(blob);
        const a    = document.createElement('a');
        a.href     = url;
        a.download = 'cyclus-event.ics';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
  
      e.target.reset();
    });


    function render(list) {
      document.getElementById('counter').textContent = list.length;
      document.getElementById('nameWall').textContent = list.map(o => o.name || 'Anonymous').join('\u00a0');
    }

    document.getElementById('attendForm').addEventListener('submit', e => {
      e.preventDefault();
      const fd = new FormData(e.target);
      writeName(fd.get('name').trim(), fd.get('phone').trim());
      e.target.reset();
    });

    fetchNames();
  </script>
</body>
</html>
